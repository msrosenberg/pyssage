import pyssage.quadvar
import pyssage.graph
from tests.test_common import test_transect


def test_wrap_transect():
    n = 100
    steps = 10
    # test wrapping positive
    answer = [95, 96, 97, 98, 99, 0, 1, 2, 3, 4]
    start = 95
    for i in range(steps):
        assert answer[i] == pyssage.quadvar.wrap_transect(start + i, n)
    # test wrapping negative
    answer = [4, 3, 2, 1, 0, 99, 98, 97, 96, 95]
    start = 4
    for i in range(steps):
        assert answer[i] == pyssage.quadvar.wrap_transect(start - i, n)


def test_ttlqv():
    # answer calculated from PASSaGE 2 and exported to 5 decimals
    answer = (0.00769,
              0.02311,
              0.04888,
              0.08508,
              0.13175,
              0.18896,
              0.25678,
              0.33527,
              0.4245,
              0.52453,
              0.63542,
              0.75726,
              0.89009,
              1.034,
              1.18904,
              1.35529,
              1.53282,
              1.7217,
              1.92199,
              2.13378,
              2.35636,
              2.58468,
              2.81373,
              3.03927,
              3.25774,
              3.46607,
              3.66163,
              3.84213,
              4.00555,
              4.15014,
              4.27432,
              4.37669,
              4.456,
              4.51111,
              4.54099,
              4.54468,
              4.52133,
              4.47013,
              4.39034,
              4.28126,
              4.14399,
              3.98866,
              3.81838,
              3.63601,
              3.44417,
              3.24524,
              3.04146,
              2.83486,
              2.62733,
              2.42063,
              2.2164,
              2.01616,
              1.82132,
              1.63322,
              1.45311,
              1.28216,
              1.12148,
              0.97211,
              0.83503,
              0.71119,
              0.60121,
              0.50417,
              0.41902,
              0.34474,
              0.28041,
              0.22512,
              0.17803,
              0.13836,
              0.10534,
              0.07826,
              0.05645,
              0.03925,
              0.02606,
              0.01628,
              0.00938,
              0.0048,
              0.00205,
              0.00064,
              0.00011,
              0,
              0.00009,
              0.00056,
              0.00175,
              0.00402,
              0.0077,
              0.01311,
              0.02055,
              0.03033,
              0.04273,
              0.05803,
              0.07651,
              0.09843,
              0.12404,
              0.15359,
              0.18732,
              0.22546,
              0.26825,
              0.3159,
              0.36864,
              0.42667,
              0.49004,
              0.55783,
              0.62894,
              0.70233,
              0.77697,
              0.85186,
              0.92605,
              0.99858,
              1.06853,
              1.13503,
              1.19719,
              1.25417,
              1.30514,
              1.34929,
              1.38582,
              1.41396,
              1.43296,
              1.44207,
              1.44057,
              1.42774,
              1.40356,
              1.37157,
              1.33258,
              1.28738,
              1.23674,
              1.18144,
              1.1222,
              1.05976,
              0.99482,
              0.92808,
              0.86021,
              0.79189,
              0.72376,
              0.65647,
              0.59065,
              0.5269,
              0.46585,
              0.40808,
              0.35418,
              0.30472,
              0.26016,
              0.2203,
              0.18484,
              0.15349,
              0.12599,
              0.10205,
              0.08142,
              0.06382,
              0.049,
              0.0367,
              0.02669,
              0.0187,
              0.01251,
              0.00788,
              0.00457,
              0.00236,
              0.00101,
              0.00032,
              0.00005,
              0,
              0.00005,
              0.00028,
              0.00088,
              0.00204,
              0.00393,
              0.00673,
              0.01062,
              0.01577,
              0.02234,
              0.03053,
              0.04048,
              0.05238,
              0.06637,
              0.08264,
              0.10134,
              0.12264,
              0.14669,
              0.17365,
              0.20369,
              0.23696,
              0.27353,
              0.31292,
              0.35453,
              0.39779,
              0.44211,
              0.48693,
              0.53168,
              0.57579,
              0.61872,
              0.65991,
              0.6988,
              0.73487,
              0.76756,
              0.79634,
              0.82067,
              0.84004,
              0.8539,
              0.86173,
              0.86302,
              0.85724,
              0.84438,
              0.82691,
              0.80528,
              0.77988,
              0.75114,
              0.71948,
              0.6853,
              0.649,
              0.61101,
              0.5717,
              0.5315,
              0.49078,
              0.44996,
              0.40941,
              0.36954,
              0.33073,
              0.29337,
              0.25784,
              0.22453,
              0.19384,
              0.16605,
              0.14108,
              0.11876,
              0.09895,
              0.08149,
              0.06622,
              0.053,
              0.04168,
              0.0321,
              0.02412,
              0.01759,
              0.01237,
              0.0083,
              0.00524,
              0.00305,
              0.00158,
              0.00068,
              0.00022,
              0.00004,
              0,
              0.00003,
              0.00018,
              0.00058,
              0.00135,
              0.00261,
              0.00448,
              0.00708,
              0.01055,
              0.01499,
              0.02054,
              0.02732,
              0.03544,
              0.04504,
              0.05624,
              0.06916,
              0.08393,
              0.10066,
              0.1195,
              0.14056,
              0.16397,
              0.18979,
              0.21771,
              0.24731,
              0.2782,
              0.30996,
              0.3422,
              0.3745,
              0.40645,
              0.43766,
              0.4677,
              0.49617,
              0.52265,
              0.54674,
              0.56801,
              0.58605,
              0.60044,
              0.61076,
              0.61659,
              0.61749,
              0.61305,
              0.6033,
              0.59052,
              0.57496,
              0.5569,
              0.53658,
              0.51427,
              0.49023,
              0.46473,
              0.43803,
              0.4104,
              0.3821,
              0.3534,
              0.32457,
              0.29588,
              0.2676,
              0.24001,
              0.21338,
              0.18799,
              0.16411,
              0.14204,
              0.12201,
              0.10393,
              0.08772,
              0.07328,
              0.06051,
              0.0493,
              0.03957,
              0.0312,
              0.02409,
              0.01815,
              0.01328,
              0.00936,
              0.0063,
              0.00399,
              0.00233,
              0.00121,
              0.00052,
              0.00017,
              0.00003,
              0,
              0.00002,
              0.00013,
              0.00042,
              0.00098,
              0.00191,
              0.00329,
              0.00521,
              0.00778,
              0.01109,
              0.01524,
              0.02033,
              0.02645,
              0.03371,
              0.04221,
              0.05206,
              0.06336,
              0.07622,
              0.09075,
              0.10706,
              0.12526,
              0.14542,
              0.1673,
              0.19059,
              0.21498,
              0.24015,
              0.26576,
              0.2915,
              0.31702,
              0.342,
              0.36608,
              0.38892,
              0.41016,
              0.42945,
              0.44641,
              0.46068,
              0.47187,
              0.4796,
              0.48347,
              0.48309,
              0.47804,
              0.46846,
              0.45698,
              0.44374,
              0.42891,
              0.41264,
              0.39509,
              0.37642,
              0.3568,
              0.3364,
              0.31539,
              0.29395,
              0.27224,
              0.25046,
              0.22879,
              0.20742,
              0.18654,
              0.16635,
              0.14705,
              0.12885,
              0.11195,
              0.09655,
              0.08258,
              0.06999,
              0.05871,
              0.04868,
              0.03984,
              0.03211,
              0.02542,
              0.01972,
              0.01493,
              0.01096,
              0.00776,
              0.00525,
              0.00334,
              0.00196,
              0.00102,
              0.00044,
              0.00014,
              0.00002,
              0,
              0.00002,
              0.0001,
              0.00031,
              0.00072,
              0.00141,
              0.00244,
              0.00388,
              0.00583,
              0.00836,
              0.01156,
              0.0155,
              0.02029,
              0.02602,
              0.03278,
              0.04067,
              0.04981,
              0.06031,
              0.07227,
              0.08582,
              0.10108,
              0.11815,
              0.13686,
              0.15694,
              0.17813,
              0.20015,
              0.22271,
              0.2455,
              0.26821,
              0.2905,
              0.31203,
              0.33243,
              0.35132,
              0.36829,
              0.38292,
              0.39477,
              0.40336,
              0.4082,
              0.40876,
              0.40448,
              0.39477,
              0.38002,
              0.36496,
              0.34963,
              0.33406,
              0.31828,
              0.30235,
              0.28629,
              0.27015,
              0.25398,
              0.23783,
              0.22176,
              0.20582,
              0.19007,
              0.17459,
              0.15944,
              0.1447,
              0.13047,
              0.11682,
              0.10387,
              0.09172,
              0.08047,
              0.07006,
              0.06047,
              0.0517,
              0.04371,
              0.0365,
              0.03005,
              0.02432,
              0.0193,
              0.01496,
              0.01126,
              0.00818,
              0.00568,
              0.00372,
              0.00225,
              0.00121,
              0.00054,
              0.00018,
              0.00003,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0)

    result = pyssage.quadvar.ttlqv(test_transect())
    pyssage.graph.draw_quadvar_result(result, "TTLQV Test")
    for i in range(500):
        assert answer[i] == round(result[i, 1], 5)


def test_3tlqv():
    # answer calculated from PASSaGE 2 and exported to 5 decimals
    answer = (0.00385,
              0.00965,
              0.01935,
              0.033,
              0.05063,
              0.07227,
              0.09796,
              0.12774,
              0.16164,
              0.19971,
              0.24198,
              0.2885,
              0.33929,
              0.39467,
              0.45869,
              0.53658,
              0.63242,
              0.74946,
              0.89035,
              1.05726,
              1.25191,
              1.47135,
              1.70943,
              1.96102,
              2.22175,
              2.48791,
              2.7563,
              3.02261,
              3.28056,
              3.52436,
              3.74893,
              3.94972,
              4.12266,
              4.26406,
              4.37059,
              4.4392,
              4.4671,
              4.45171,
              4.39065,
              4.28168,
              4.12797,
              3.94743,
              3.74516,
              3.52585,
              3.2938,
              3.05297,
              2.80707,
              2.55949,
              2.31342,
              2.07182,
              1.83748,
              1.613,
              1.40083,
              1.20321,
              1.02119,
              0.85522,
              0.70575,
              0.57319,
              0.45799,
              0.36054,
              0.28122,
              0.21871,
              0.17023,
              0.13315,
              0.10498,
              0.08334,
              0.06597,
              0.05137,
              0.03919,
              0.02919,
              0.02111,
              0.01472,
              0.00981,
              0.00616,
              0.00357,
              0.00185,
              0.00081,
              0.00027,
              0.00005,
              0,
              0.00005,
              0.00023,
              0.00069,
              0.00156,
              0.00295,
              0.005,
              0.00783,
              0.01155,
              0.01627,
              0.02211,
              0.02917,
              0.03757,
              0.0474,
              0.0588,
              0.0725,
              0.08952,
              0.11088,
              0.13755,
              0.17052,
              0.21072,
              0.25912,
              0.31589,
              0.38016,
              0.45107,
              0.5278,
              0.60955,
              0.69551,
              0.78454,
              0.87476,
              0.96428,
              1.05126,
              1.13388,
              1.21034,
              1.27889,
              1.33778,
              1.38532,
              1.41981,
              1.43959,
              1.44301,
              1.42843,
              1.39658,
              1.3544,
              1.30318,
              1.24415,
              1.17853,
              1.10754,
              1.03235,
              0.95414,
              0.87407,
              0.79326,
              0.71286,
              0.63397,
              0.5577,
              0.48511,
              0.41683,
              0.35331,
              0.29496,
              0.24223,
              0.19554,
              0.15532,
              0.12206,
              0.09561,
              0.07495,
              0.05907,
              0.04696,
              0.03762,
              0.03007,
              0.02364,
              0.01821,
              0.01369,
              0.00999,
              0.00703,
              0.00473,
              0.003,
              0.00175,
              0.00092,
              0.0004,
              0.00013,
              0.00003,
              0,
              0.00002,
              0.00012,
              0.00035,
              0.00078,
              0.00149,
              0.00255,
              0.00402,
              0.00598,
              0.00849,
              0.01162,
              0.01544,
              0.02002,
              0.02544,
              0.03179,
              0.03943,
              0.04893,
              0.06081,
              0.07562,
              0.09391,
              0.11623,
              0.14325,
              0.17536,
              0.21216,
              0.25323,
              0.29817,
              0.34655,
              0.39797,
              0.45177,
              0.50685,
              0.56205,
              0.6162,
              0.66812,
              0.71663,
              0.76052,
              0.79861,
              0.82966,
              0.85245,
              0.86572,
              0.86821,
              0.85865,
              0.83786,
              0.81192,
              0.78138,
              0.74679,
              0.70872,
              0.66772,
              0.62437,
              0.57924,
              0.53291,
              0.48597,
              0.43901,
              0.39264,
              0.34747,
              0.3041,
              0.2629,
              0.22417,
              0.18821,
              0.15533,
              0.12584,
              0.10007,
              0.07848,
              0.06134,
              0.04799,
              0.03779,
              0.03009,
              0.02421,
              0.01947,
              0.01541,
              0.01194,
              0.00904,
              0.00664,
              0.0047,
              0.00318,
              0.00203,
              0.0012,
              0.00063,
              0.00028,
              0.00009,
              0.00002,
              0,
              0.00001,
              0.00007,
              0.00022,
              0.0005,
              0.00096,
              0.00165,
              0.00262,
              0.00392,
              0.0056,
              0.00773,
              0.01035,
              0.01353,
              0.01733,
              0.02182,
              0.02722,
              0.03384,
              0.04197,
              0.05192,
              0.06403,
              0.07864,
              0.09635,
              0.11805,
              0.14351,
              0.17254,
              0.2049,
              0.24038,
              0.27873,
              0.31952,
              0.36189,
              0.40487,
              0.44746,
              0.48859,
              0.52715,
              0.56197,
              0.59182,
              0.61538,
              0.63128,
              0.63805,
              0.63413,
              0.61785,
              0.59106,
              0.56373,
              0.53595,
              0.50776,
              0.47925,
              0.45049,
              0.42156,
              0.39255,
              0.36356,
              0.33468,
              0.30602,
              0.2777,
              0.24985,
              0.22259,
              0.19598,
              0.17016,
              0.14531,
              0.12161,
              0.09929,
              0.07857,
              0.06027,
              0.0459,
              0.03499,
              0.02701,
              0.02138,
              0.01742,
              0.0144,
              0.01174,
              0.00939,
              0.00734,
              0.00558,
              0.0041,
              0.00289,
              0.00192,
              0.00118,
              0.00065,
              0.0003,
              0.00011,
              0.00002,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0,
              0)

    result = pyssage.quadvar.threetlqv(test_transect())
    pyssage.graph.draw_quadvar_result(result, "3TLQV Test")
    for i in range(333):
        assert answer[i] == round(result[i, 1], 5)
